# 📝 要件定義書（更新版）

by claude3.7

## 📋 目次

1. プロジェクト概要
2. 機能要件
3. 非機能要件
4. 技術スタック
5. データモデル
6. UI設計方針
7. 開発アプローチ
8. 実装状況

## 🚀 1. プロジェクト概要

「カタマリ」（旧：カタワク）は、3Dプリントに関する知識・経験・制作物を記事として共有できるウェブプラットフォームです。単なるモデル共有ではなく、創作体験や制作過程も含めた「ストーリー」や「プロセス」を重視し、「3Dプリントで、共有する喜び」をコンセプトに、初心者から上級者まで幅広いユーザーをサポートします。

## 💻 2. 機能要件

### 2.1 必須要件（Must）

1. 👤 ユーザー認証 【実装済み】
    - Googleアカウント連携による簡単認証
    - 基本的なユーザープロフィール表示、修正（名前、アイコン）
2. 📝 記事投稿・管理機能 【実装中】
    - 3Dモデルファイルのアップロード機能
    - 3Dモデルファイルのダウンロード機能
    - リッチテキストエディタによる記事作成
    - 記事内への画像・動画の埋め込み
    - STL/OBJファイルの3Dプレビュー
    - 制作ファイル一式のアップロード（フォルダ構造維持）
    - 下書き保存・公開設定
3. 🎨 UI/UX 【実装中】
    - シンプルなユーザーインターフェース
    - レスポンシブデザイン（スマホ/タブレット/PC対応）
    - 直感的で親しみやすいボタンデザイン
4. 🔍 検索・閲覧機能 【未実装】
    - 基本的な検索機能
    - 閲覧数・ダウンロード数の記録
    - SNS共有機能

🔧 その他

- バンブー製品への販売リンク設置 【未実装】
- Supabaseを使ったDBシステム 【実装済み】
- Google Analytics 4によるトラッキング 【未実装】
- 3Dモデルビューア（Three.js）【未実装】

### 2.2 画面構成

1. 🏠 ホーム画面 【実装中】
    - 人気モデル表示
    - 新着モデル表示
2. 📝 記事詳細画面 【未実装】
    - 記事タイトル、著者情報
    - Hero画像
    - 記事本文（画像・動画・3Dモデル埋め込み）
    - 制作ファイル一式ダウンロードセクション
    - ファイル構造プレビュー
    - SNSシェアボタン
3. 👤 ユーザー関連画面 【実装済み】
    - ログイン（グーグル認証）
    - マイページ（アップロードしたモデル一覧）
    - 記事作成・編集画面
    - 記事一覧・管理画面
4. 🔍 検索・閲覧関連画面 【未実装】
    - 検索結果表示画面

## ⚙️ 3. 非機能要件

### 3.1 パフォーマンス

- ページ読み込み速度： 3秒以内
- 大容量ファイル（STL/OBJなど）の効率的な読み込み

### 3.2 セキュリティ 【実装済み】

- Googleアカウント認証によるセキュアなアクセス
- ユーザーデータの保護（RLSポリシーによる）
- ファイルアクセス制御
- アップロードファイルの安全性チェック
- SSL/TLS暗号化によるデータ保護

### 3.3 使いやすさ

- 技術的背景がないユーザーでも直感的に操作できるUI
- 明確なフィードバックとエラーメッセージ
- モバイルでの快適な閲覧・操作体験
- 制作工程を共有しやすいコンテンツ構造

### 3.4 拡張性

- 将来的な機能追加に対応できる設計
- 会員サブスクリプションモデルへの移行を想定した設計
- コミュニティ機能への拡張が容易な構造
- クリエイターエコノミーを支える基盤設計

## 🔧 4. 技術スタック

### 4.1 フロントエンド 【確定】

- Next.js 14 (App Router)
- React 18
- TailwindCSS
- TipTap（リッチテキストエディタ）
- Three.js（3Dモデルビューア）

### 4.2 バックエンド 【確定】

- Supabase（グーグル認証連携、データベース、ストレージ）
- Next.js Server Actions（サーバーサイド処理）

### 4.3 デプロイ 【確定】

- Vercel

## 📊 5. データモデル 【実装済み】

### 5.1 ユーザーテーブル

- id (PK) - uuid
- name - text
- email - text
- avatar_url - text
- created_at - timestamp

### 5.2 記事テーブル（articles）

- id (PK) - uuid
- user_id (FK) - uuid
- title - text
- content - json（リッチテキスト用）
- summary - text
- hero_image_id - uuid（FK to article_media）
- status - text ('draft', 'published')
- created_at - timestamp
- updated_at - timestamp
- published_at - timestamp
- view_count - integer
- download_count - integer
- has_stl_file - boolean

### 5.3 メディアテーブル（article_media）

- id (PK) - uuid
- article_id (FK) - uuid
- user_id (FK) - uuid
- filename - text
- filesize - integer
- media_type - text ('image', 'video', 'stl', 'obj')
- media_role - text ('hero', 'content')
- storage_path - text
- width - integer
- height - integer
- created_at - timestamp

### 5.4 ファイルテーブル（files）

- id (PK) - uuid
- article_id (FK) - uuid
- user_id (FK) - uuid
- filename - text
- filesize - integer
- filetype - text
- filepath - text
- relative_path - text
- parent_folder - text
- storage_path - text
- is_stl - boolean
- is_obj - boolean
- created_at - timestamp

## 🎨 6. UI設計方針

### 6.1 デザインシステム

- カラーパレット：明るく親しみやすい色調（「カタマリ」コンセプトに合わせて）
- タイポグラフィ：読みやすさと創造性を感じさせるデザイン
- アイコン・ボタンデザイン：記事作成・閲覧フローを重視した配置と視認性

### 6.2 視覚的な差別化要素

- 3Dモデルのプレビュー表示（回転・拡大縮小機能）【未実装】
- 制作例の写真ギャラリー（完成イメージの視覚化）【未実装】
- 記事と制作ファイルの明確な区分表示
- リッチな記事表現（画像・動画・3Dモデル埋め込み）
- ファイル構造の視覚的プレビュー
- 創作プロセスを強調したコンテンツレイアウト

## 📈 7. 開発アプローチ

### 7.1 開発方針

- シンプルさを重視
- 最小限の機能でスピーディにリリース
- 1人で運営可能な規模を維持
- 外部サービスを活用して開発工数削減
- フェーズ別の段階的実装（基本機能→ファイル管理→メディア機能→UI/UX改善）
- ユーザー体験を優先した機能選定
- SNS拡散性を高めるデザインと機能

## 📋 8. 実装状況

### 8.1 実装済み機能

- Google OAuth認証フロー
- ユーザー管理システム
  - ユーザープロフィール表示
  - 自動ユーザー作成トリガー
- モデルアップロード機能
- ファイルバリデーション
- Supabaseストレージへの保存
- メタデータのデータベース登録
- モデル表示機能
- モデル詳細表示
- サムネイル表示
- ダウンロードリンク
- モデル編集機能
  - タイトル・説明の編集
  - サムネイルの更新
- モデル削除機能
  - ストレージファイル削除
  - データベースレコード削除
- データベースRLSポリシー設定
- ストレージセキュリティ設定
- レスポンシブUI実装
  - ヘッダー・フッター
  - ホームページ
  - プロフィールページ

### 8.2 未実装機能

- リッチテキストエディタによる記事作成
- 画像・動画のアップロード・埋め込み
- フォルダ構造を維持したファイルアップロード
- STL/OBJファイルの3Dプレビュー
- 記事詳細表示ページ
- 制作ファイル一式ダウンロード機能
- ファイル構造プレビュー
- SNS共有機能
- アクセス計測（閲覧数・ダウンロード数）