# 📝 要件定義書（更新版）

by claude3.7

## 📋 目次

1. プロジェクト概要
2. 機能要件
3. 非機能要件
4. 技術スタック
5. データモデル
6. UI設計方針
7. 開発アプローチ
8. 実装状況

## 🚀 1. プロジェクト概要

「カタマリ」（旧：カタワク）は、3Dプリントに関する知識・経験・制作物を記事として共有できるウェブプラットフォームです。単なるモデル共有ではなく、創作体験や制作過程も含めた「ストーリー」や「プロセス」を重視し、「3Dプリントで、共有する喜び」をコンセプトに、初心者から上級者まで幅広いユーザーをサポートします。

## 💻 2. 機能要件

### 2.1 認証機能
- ✅ Google OAuth認証によるログイン
- ✅ ユーザープロフィール表示・編集
- ✅ アバター画像のアップロード
- ✅ デフォルトアバター（Googleアカウント画像）の使用

### 2.2 記事管理機能
- ✅ リッチテキストエディタによる記事作成
- ✅ 画像・動画のアップロードと埋め込み
- ✅ 3Dモデルプレビューの埋め込み
- ✅ 下書き保存機能
- ✅ 公開/非公開設定
- ✅ 記事編集・削除
- ✅ ヒーロー画像設定
- ✅ 記事検索（タイトル、内容）
- ✅ SEO最適化のためのメタデータ管理

### 2.3 ファイル管理機能
- ✅ 3Dモデル（STL/OBJ）およびその他関連ファイルのアップロード
- ✅ ファイル一覧表示
- ✅ ダウンロード機能
- ✅ ダウンロード数の集計

### 2.4 SNS連携機能
- ✅ SNSシェアボタン（Twitter/X、Facebook、LINE）
- ❌ シェア数カウント機能（却下）
- ❌ タグ付け機能（却下）

### 2.5 プロフィール機能
- ✅ ユーザープロフィールページ
- ✅ プロフィール情報編集
- ✅ SNSリンク設定（Twitter/X、Instagram、Facebook、TikTok、GitHub）
- ✅ Webサイトリンク設定（最大3つ）
- ✅ 自己紹介文の設定

### 2.6 アナリティクス機能
- ✅ 閲覧数の集計
- ✅ ダウンロード数の集計
- ✅ Google Analyticsの導入

## 🧰 3. 非機能要件

### 3.1 パフォーマンスと品質
- 高速なレスポンス時間
- 安定したファイルアップロード/ダウンロード
- モバイルデバイスを含むクロスプラットフォーム対応

### 3.2 セキュリティ
- ✅ RLS（Row Level Security）による堅牢なアクセス制御
- ✅ CSRFトークンによる保護
- ✅ HTTPSによる通信の暗号化
- ✅ 認証・認可の適切な実装

### 3.3 アクセシビリティと拡張性
- レスポンシブデザイン（モバイル対応）
- アクセシビリティへの配慮
- 将来的な機能拡張への対応

## 🖥️ 4. 技術スタック

### 4.1 フロントエンド
- Next.js 14（App Router）
- React
- Tailwind CSS
- TipTap（リッチテキストエディタ）
- Three.js（3Dビューア）

### 4.2 バックエンド
- Supabase（PostgreSQL、認証、ストレージ）
- Vercel Edge Functions

### 4.3 インフラ
- Vercel（ホスティング）
- Supabase（BaaS）

### 4.4 分析・モニタリング
- Google Analytics 4
- Vercel Analytics

## 📊 5. データモデル

以下は主要なデータモデルの概要です。詳細な定義は「データベース詳細設計書」を参照してください。

### 5.1 主要テーブル

- **users**: ユーザー情報を管理するテーブル。Google認証と連携し、プロフィール情報やSNSリンクを格納。
- **articles**: 記事情報を管理するテーブル。タイトル、本文、公開ステータスなどを格納。
- **article_media**: 記事に添付されるメディア（画像、動画、3Dモデル）情報を管理するテーブル。
- **article_metadata**: 記事のメタデータ（SEO情報など）を管理するテーブル。
- **download_files**: 記事からダウンロード可能なファイルを管理するテーブル。
- **favorites**: ユーザーのお気に入り記事を管理するテーブル。

### 5.2 ストレージバケット

- **avatars**: ユーザーアバターを格納するバケット。公開設定。
- **article_media**: 記事内のメディア（画像、動画、3Dモデル）を格納するバケット。公開設定。
- **downloads**: ダウンロード用のファイルを格納するバケット。公開設定。

### 5.3 ※実装されないデータモデル
以下の機能は却下され、実装されません：

- タグ機能（tagsテーブル、article_tagsテーブル）
- シェア機能（sharesテーブル）
- コメント機能（commentsテーブル）

## 🎨 6. UI設計方針

### 6.1 全体デザイン
- モダンでクリーンなデザイン
- 色彩：ブルーとインディゴを基調としたカラースキーム
- タイポグラフィ：読みやすさを重視
- アクセシビリティ：コントラスト比の確保

### 6.2 レイアウト
- ヘッダー：ナビゲーション、検索バー、ユーザーメニュー
- フッター：サイト情報、リンク
- メインコンテンツ：コンテキストに応じた適応型レイアウト

### 6.3 レスポンシブデザイン
- モバイルファースト設計
- ブレイクポイント：480px、768px、1024px、1280px
- コンテンツの優先順位付けとリフロー

### 6.4 共通コンポーネント
- ボタン：プライマリ、セカンダリ、アクション
- カード：情報表示の基本単位
- フォーム要素：入力フィールド、チェックボックス、ラジオボタン
- モーダル/ダイアログ：確認、詳細表示
- ローディング状態：スケルトンローダー、スピナー

## 🔧 7. 開発アプローチ

### 7.1 開発プロセス
- アジャイル開発（1週間スプリント）
- 継続的インテグレーション/継続的デリバリー（CI/CD）
- 機能ごとの段階的リリース

### 7.2 テスト戦略
- 単体テスト：主要ロジックのテスト
- 統合テスト：コンポーネント間の連携確認
- E2Eテスト：主要ユーザーフロー
- パフォーマンステスト：ロード時間、応答性

### 7.3 デプロイメント
- 開発環境：ローカル開発サーバー
- ステージング環境：Vercel Preview Deployments
- 本番環境：Vercel Production

### 7.4 モニタリング・分析
- エラー追跡：Vercel Error Tracking
- パフォーマンス監視：Vercel Analytics
- ユーザー行動分析：Google Analytics 4

## 📝 8. 実装状況

### 8.1 認証機能
- ✅ Google OAuth認証によるログイン
- ✅ ユーザープロフィール情報の取得
- ✅ ユーザープロフィール編集
- ✅ デフォルトアバター（Google）の利用
- ✅ カスタムアバターのアップロード

### 8.2 記事管理機能
- ✅ 記事作成フォーム
- ✅ リッチテキストエディタ
- ✅ 記事一覧表示
- ✅ 記事詳細表示
- ✅ 記事編集・削除
- ✅ 下書き保存
- ✅ 公開/非公開切り替え
- ✅ 画像アップロード
- ✅ 動画埋め込み
- ✅ 3Dモデル埋め込み
- ✅ SEOメタデータ管理

### 8.3 ファイル管理機能
- ✅ 3Dモデルファイルアップロード
- ✅ 複数ファイルのアップロード
- ✅ フォルダ構造の維持
- ✅ ファイル一覧表示
- ✅ ダウンロード機能
- ✅ 自動バリデーション（STLファイル必須）

### 8.4 実装しないことに決定した機能
- ❌ タグ関連機能
- ❌ 記事シェア数カウント機能
- ❌ いいね機能
- ❌ コメント機能

### 8.5 次のマイルストーン
1. リッチテキストエディタの完全実装
2. 記事詳細表示ページの完成
3. 画像・メディアアップロード機能の改善
4. 基本的な共有機能の実装